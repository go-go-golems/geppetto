# WebSocket Broadcast Path Inventory

## Broadcast and targeted send callsites
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/timeline_upsert.go:48:		conv.pool.Broadcast(b)
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/connection_pool.go:106:func (cp *ConnectionPool) Broadcast(data []byte) {
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/connection_pool.go:128:func (cp *ConnectionPool) SendToOne(conn wsConn, data []byte) {
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/router.go:459:				conv.pool.SendToOne(conn, b)
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/router.go:504:							conv.pool.SendToOne(conn, b)
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/conversation.go:228:						c.pool.Broadcast(frame)
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/conversation.go:297:				conv.pool.Broadcast(frame)
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/connection_pool_test.go:63:	pool.Broadcast([]byte("one"))
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/connection_pool_test.go:64:	pool.Broadcast([]byte("two"))
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/connection_pool_test.go:65:	pool.Broadcast([]byte("three"))

## Timeline upsert emission path
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/timeline_upsert.go:9:// TimelineUpsertHook exposes the timeline upsert hook for external use.
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/timeline_upsert.go:10:func (r *Router) TimelineUpsertHook(conv *Conversation) func(entity *timelinepb.TimelineEntityV1, version uint64) {
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/timeline_upsert.go:11:	if r != nil && r.timelineUpsertHookOverride != nil {
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/timeline_upsert.go:12:		return r.timelineUpsertHookOverride(conv)
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/timeline_upsert.go:14:	return r.timelineUpsertHookDefault(conv)
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/timeline_upsert.go:17:func (r *Router) timelineUpsertHookDefault(conv *Conversation) func(entity *timelinepb.TimelineEntityV1, version uint64) {
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/timeline_upsert.go:22:		r.emitTimelineUpsert(conv, entity, version)
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/timeline_upsert.go:26:func (r *Router) emitTimelineUpsert(conv *Conversation, entity *timelinepb.TimelineEntityV1, version uint64) {
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/timeline_upsert.go:41:			"type": "timeline.upsert",
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/types.go:120:	timelineUpsertHookOverride func(*Conversation) func(entity *timelinepb.TimelineEntityV1, version uint64)
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/router_options.go:75:func WithTimelineUpsertHook(fn func(*Conversation) func(entity *timelinepb.TimelineEntityV1, version uint64)) RouterOption {
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/router_options.go:80:		r.timelineUpsertHookOverride = fn
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/router.go:156:			TimelineUpsertHook: r.TimelineUpsertHook,
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/router.go:794:			r.emitTimelineUpsert(conv, entity, version)
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/conversation.go:66:	timelineUpsertHook func(*Conversation) func(entity *timelinepb.TimelineEntityV1, version uint64)
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/conversation.go:86:	TimelineUpsertHook func(*Conversation) func(entity *timelinepb.TimelineEntityV1, version uint64)
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/conversation.go:103:		timelineUpsertHook: opts.TimelineUpsertHook,
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/conversation.go:177:			hook := cm.timelineUpsertHook
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/conversation.go:259:		hook := cm.timelineUpsertHook

## Stream coordinator callback path
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/timeline_upsert.go:48:		conv.pool.Broadcast(b)
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/conversation.go:218:			c.stream = NewStreamCoordinator(
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/conversation.go:228:						c.pool.Broadcast(frame)
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/conversation.go:234:						_ = c.timelineProj.ApplySemFrame(c.baseCtx, frame)
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/conversation.go:287:	conv.stream = NewStreamCoordinator(
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/conversation.go:297:				conv.pool.Broadcast(frame)
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/conversation.go:303:				_ = conv.timelineProj.ApplySemFrame(conv.baseCtx, frame)
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/stream_coordinator.go:31:	onFrame func(events.Event, StreamCursor, []byte)
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/stream_coordinator.go:40:func NewStreamCoordinator(
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/stream_coordinator.go:44:	onFrame func(events.Event, StreamCursor, []byte),
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/stream_coordinator.go:50:		onFrame:    onFrame,
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/stream_coordinator.go:136:		if sc.onFrame != nil {
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/stream_coordinator.go:137:			for _, frame := range SemanticEventsFromEventWithCursor(ev, cur) {
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/stream_coordinator.go:141:				sc.onFrame(ev, cur, frame)
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/stream_coordinator.go:210:func SemanticEventsFromEventWithCursor(e events.Event, cur StreamCursor) [][]byte {
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/connection_pool_test.go:63:	pool.Broadcast([]byte("one"))
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/connection_pool_test.go:64:	pool.Broadcast([]byte("two"))
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/connection_pool_test.go:65:	pool.Broadcast([]byte("three"))
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/stream_coordinator_test.go:41:	sc := NewStreamCoordinator("c1", sub, nil, func(_ events.Event, cur StreamCursor, _ []byte) {
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/stream_coordinator_test.go:67:	sc := NewStreamCoordinator("c1", sub, nil, func(_ events.Event, cur StreamCursor, _ []byte) {
/home/manuel/workspaces/2026-02-13/mv-debug-ui-geppetto/pinocchio/pkg/webchat/conv_manager_eviction_test.go:90:		stream:   NewStreamCoordinator("c1", sub, nil, nil),
