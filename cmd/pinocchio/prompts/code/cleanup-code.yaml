name: cleanup-code
short: Clean up a code file generated by a verbose language model.
factories:
  client:
    timeout: 120
  chat:
    temperature: 0.2
    max_response_tokens: 2048
    stop: []
    stream: true
flags:
  - name: code
    type: file
    help: The code file to be refined
    required: true
  - name: additional_system
    type: string
    help: Additional system prompt
    default: ""
  - name: additional
    type: string
    help: Additional prompt
    default: ""
  - name: context
    type: fileList
    help: Additional context from files
  - name: concise
    type: bool
    help: Give concise answers
    default: true
  - name: use_bullets
    type: bool
    help: Use bullet points in the explanation
    default: true
  - name: use_keywords
    type: bool
    help: Use keywords in the explanation
    default: true
system-prompt: |
    You are an advanced language model. Your task is to refine a code file generated by a verbose language model. Your primary objectives are:
    1. Remove unnecessary comments that do not contribute to the understanding of the code.
    2. Add a docstring at the beginning of each function. This docstring should clearly explain the function's purpose, its usage, and any edge cases that users should be aware of.
    {{ .additional_system }}
prompt: |
  Here is the code file that needs to be refined:
  ---
  {{ .code.Content }}
  ---
  The goal is to produce a code file that is concise, clear, and easily understandable, with docstrings that provide valuable insights to any user of the code. 

  Your output should follow this structure:

  1. **Code Section**: This section should contain the refined code, free from unnecessary comments. Each function should be preceded by a comprehensive docstring. Try to emit the code in full and not skip any sections.

  2. **Explanation Section**: This section should provide a brief explanation of the changes you made to the code and why. This will help users understand your thought process and the rationale behind your modifications.

  {{ if .additional }}
  Additional instructions:
  {{ .additional }}
  {{ end }}
  
  {{ if .context}}Additional Context:
  {{ range .context }}
  Path: {{ .Path }}
  ---
  {{ .Content }}
  ---
  {{- end }}
  {{ end }}
  {{ if .concise -}}
  Give a concise explanation, answer in a single sentence if possible, skip unnecessary explanations. This instruction doesn't affect the docstring.
  {{- end }}
  {{ if .use_bullets -}}
  Use bullet points in the explanation. This instruction doesn't affect the docstring.
  {{- end }}
  {{ if .use_keywords -}}
  Use keywords in the explanation, not full sentences. This instruction doesn't affect the docstring.
  {{- end }}
